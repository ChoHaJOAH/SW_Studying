# 회복 기법과 병행 제어

## 1. 회복

- 여러 가지 요인으로 인해 손상된 데이터베이스를 손상되기 이전의 정상적인 상태로 복구시키는 작업

#### 1) 회복 기법

- 즉시 갱신 기법
  - 트랜잭션이 실행 상태에서 변경되는 내용을 바로 데이터베이스에 적용하는 기법
  - 장애 발생 시 로그의 내용을 토대로 회복
- 지연 갱신 기법
  - 트랜잭션이 수행되어 부분 완료가 될 때가지 데이터베이스에 적용하지 않고 지연시킨 후 부분 완료가 되면 로그의 내용을 토대로 데이터베이스에 적용하는 기법
- 검사 시점 기법
  - 트랜잭션이 실행되는 중간에 검사 시점을 지정하여 검사 시점까지 수행 후 완료된 내용을 데이터베이스에 적용하는 기법
- 그림자 페이징 기법
  - 데이터베이스를 동일한 크기의 단위인 페이지로 나누어 각 페이지마다 복사하여 그림자 페이지를 보관하는 기법
  - 데이터베이스의 변경되는 내용은 원본 페이지에만 적용하고, 장애가 발생되는 경우 그림자 페이지를 이용해 회복

#### 2) REDO(재수행)와 UNDO(취소)

- REDO: 트랜잭션이 수행되어 COMMIT이 되면 변경된 내용을 데이터베이스에 반영하는 과정
- UNDO: 트랜잭션이 수행되는 도중 오류가 발생하거나 비정상적으로 종료되는 경우 트랜잭션이 시작된 시점으로 되돌아가는 과정

<br />

## 2. 병행 제어(Concurrency Control)

- 트랜잭션의 병행실행 시 트랜잭션 간의 격리성을 유지하여 트랜잭션 수행에 문제가 발생되지 않도록 제어하는 것

### 1) 로킹(Locking)

- 병행 실행 시 하나의 트랜잭션이 사용하는 데이터베이스 내의 데이터를 다른 트랜잭션이 접근하지 못하게 하는 것
- 하나의 트랜잭션이 실행될 때는 'LOCK'을 설정, 실행이 완료되면 'UNLOCK'
- 로킹 단위를 크게 하면 관리는 쉽지만 병행성 수준이 낮아지고, 로킹 단위가 작으면 병행성 수준이 높아지지만 관리가 어렵고 오버헤드가 증가한다.

### 2) 로킹의 접근 허용

- 한 트랜잭션의 수행시간이 너무 길어 오랜 시간 동안 데이터에 LOCK이 설정된 상태로 지속되면 교착상태(Deadlock)가 발생할 수 있다.

- ##### 교착상태(Deadlock): 한 트랜잭션이 완료되지 못해 LOCK상태가 계속 유지되는 경우 다른 트랜잭션들의 작업이 더 이상 진행되지 못하고 무한정 기다리는 상태

- 공유 락(Shared Lock): 사용 중인 데이터에 대해 읽기만 허용하고, 쓰기는 허용하지 않는 방법

- 배타 락(Exclusive Lock): 사용 중인 데이터에 대해 읽기와 쓰기 모두 허용하지 않는 방법

### 3) 2단계 로킹 기법

- 로킹의 대표적인 기법으로 'LOCK' 설정 대상 데이터가 여러 개인 경우 모든 데이터에 'LOCK'을 설정하는 단계(확장 단계)와 완료 후 'LOCK'을 해제하는 단계(축소 단계)의 2단계로 구성된 기법
- 교착상태가 발생할 수 있는 단점이 있다.

### 4) 타임 스탬프(Time Stamp)

- 병행 제어의 또 다른 방법으로 각 트랜잭션이 데이터에 접근할 시간을 미리 지정하여 그 시간 순서에 따라 순서대로 데이터에 접근하여 수행하는 방법
- 모든 트랜잭션은 데이터의 접근 시간에 맞춰 수행하므로 교착상태가 발생하지 않는다.

<br/>

