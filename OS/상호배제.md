# 상호배제, Mutual Exclusion

: 여러 프로세스가 동시에 공유 자원을 사용하려 할 때 다른 프로세스가 해당 공유 자원을 사용하지 못하게 제어하며 각 프로세스가 번갈아서 공유 자원을 사용하도록 하는 것, 임계 구역을 유지하는 기법

- 동기화로 상호배제 보장할 수 있지만, 이 과정에서 교착 상태와 기아 상태가 발생할 수 있음

## 1. 상호배제 조건

- 두 프로세스는 동시에 공유 자원에 진입 불가
- 프로세스의 속도나 프로세서 수에 영향 받지 않음
- 공유 자원을 사용하는 프로세스만 다른 프로세스 차단 가능
- 프로세스가 공유 자원을 사용하려고 너무 오래 기다려서는 안 됨

<br />

## 2. 상호배제 방법

### 1) 데커 알고리즘

- 각 프로세스 플래그 설정 가능, 다른 프로세스 확인 후 플래그 재설정 가능
- 프로세스가 임예 영역에 진입하고 싶으면 플래그 설정하고 대기

![](D:/Hajung/git/SW_Studying/img/프로세스동기화_3.png)

![](D:/Hajung/git/SW_Studying/img/프로세스동기화_4.png)

- 임계영역 바깥에서 수행 중인 프로세스가 다른 프로세스들이 임계 영역 진입 막지 않음
- 임계 영역에 들어가기를 원하는 프로세서 무한정 기다리게 하지 않음 
- 그 외 알고리즘
  - 크누스 알고리즘, 다익스트라 알고리즘, 램포트의 베이커리(빵집) 알고리즘

### 2) TestAndSet(테스) 명령어

- 공유 변수를 수정하는 동안 인터럽트의 발생을 억제하여 임계 영역 문제 간단 해결
- 메모리 영역의 값에 대해 검사와 수정을 원자적으로 수행할 수 있는 하드웨어 명령어 
- 알고리즘이 간단, 하나의 메모리 사이클에서 수행하여 경쟁 상황 해결
- 바쁜 대기가 발생하고, 기아 상태, 교착 상태 발생 가능

```
boolean TestAndSet (boolean *target){
	boolean temp = *target; //이전 값 기록
	*target = true; 		//true로 설정
	return temp;			//값 반환
}

//lock을 사용한 상호배제
do
{
	while (TestAndSet(&lock))	//lock을 검사하여 true이면 대기, false이면 임계 영역 진입
		;
		//임계영역
	lock = false;				//다른 프로세스의 진입 허용 의미로 lock을 false로 
	//나머지 영역
}while(true);

//TestAndSet명령어를 이용한 상호배제
do
{
	waiting[i] = true;
}

```

